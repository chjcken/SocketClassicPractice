<!DOCTYPE html>
<html>
<head>
	<title></title>
</head>
<body>
	<button id="addNewObserver">Add New Observer checkbox</button>
	<input id="mainCheckbox" type="checkbox"/>
	<div id="observersContainer"></div>
	<!--What : Observer cho phép các đối tượng có thể lắng nghe và phản ứng khi có thông báo từ một đối tượng khác. Tức là khi một đối tượng gửi một thông báo, các đối tượng lắng nghe nó có thể phản ứng lại với thông báo đó.
-->
	<!--When : Khi bạn muốn các đối tượng liên lạc với nhau. Khi đối tượng này gửi 1 thông điệp thì các đối tượng đăng ký lắng nghe thông điệp sẽ phản ứng lại với thông điệp đó. Đối tượng gửi thông điệp sẽ không cần biết nó sẽ gửi cho ai và đối tượng nhận thông điệp sẽ không cần biết ai gửi thông điệp đó.
-->
	<!--How : Giả sử trong một hệ thống bán hàng, mỗi khi có sản phẩm mới hệ thống sẽ thông báo cho tất cả các khách hàng quan tâm đến sản phẩm này. Đầu tiên tôi tạo ra một lớp interface với 1 phương thức sẽ phản ứng khi có sản phẩm mới.
-->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script src= "https://ajax.googleapis.com/ajax/libs/angularjs/1.4.2/angular.min.js"></script>
<script type="text/javascript">
	function ObserverList(){
		this.observerList = [];
	}

	ObserverList.prototype.add = function( obj ){
		return this.observerList.push( obj );
	};

	ObserverList.prototype.count = function(){
		return this.observerList.length;
	};

	ObserverList.prototype.get = function( index ){
		if( index > -1 && index < this.observerList.length ){
			return this.observerList[ index ];
		}
	};

	ObserverList.prototype.indexOf = function( obj, startIndex ){
		var i = startIndex;

		while( i < this.observerList.length ){
			if( this.observerList[i] === obj ){
				return i;
			}
			i++;
		}

		return -1;
	};

	ObserverList.prototype.removeAt = function( index ){
		this.observerList.splice( index, 1 );
	};


	function Subject(){
		this.observers = new ObserverList();
	}

	Subject.prototype.addObserver = function( observer ){
		this.observers.add( observer );
	};

	Subject.prototype.removeObserver = function( observer ){
		this.observers.removeAt( this.observers.indexOf( observer, 0 ) );
	};

	Subject.prototype.notify = function( context ){
		var observerCount = this.observers.count();
		for(var i=0; i < observerCount; i++){
			this.observers.get(i).update( context );
		}
	};

	// The Observer
	function Observer(){
		this.update = function(){
    // ...
};
}

	// Extend an object with an extension
	function extend( extension, obj ){
		for ( var key in extension ){
			obj[key] = extension[key];
		}
	}

	// References to our DOM elements

	var controlCheckbox = document.getElementById( "mainCheckbox" ),
	addBtn = document.getElementById( "addNewObserver" ),
	container = document.getElementById( "observersContainer" );


	// Concrete Subject

	// Extend the controlling checkbox with the Subject class
	extend( new Subject(), controlCheckbox );

	// Clicking the checkbox will trigger notifications to its observers
	controlCheckbox.onclick = function(){
		controlCheckbox.notify( controlCheckbox.checked );
	};

	addBtn.onclick = addNewObserver;

	// Concrete Observer

	function addNewObserver(){
		
	  // Create a new checkbox to be added
	  var check = document.createElement( "input" );
	  check.type = "checkbox";
	  
	  // Extend the checkbox with the Observer class
	  extend( new Observer(), check );
	  
	  // Override with custom update behaviour
	  check.update = function( value ){
	  	this.checked = value;
	  };
	  
	  // Add the new observer to our list of observers
	  // for our main subject
	  controlCheckbox.addObserver( check );
	  
	  // Append the item to the container
	  container.appendChild( check );
	}

</script>
</body>
</html>